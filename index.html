<!DOCTYPE html>
<html>
<script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
<script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.0/aframe/build/aframe-ar.js"> </script>  
<script> 

    

    
var startAnimTree = "clip: Take 001; loop: once; crossFadeDuration: 0;";;	
var loopAnimTree = "clip: Take 002; loop: repeat; crossFadeDuration: 0;";;
var listenerAdded = false;
var scene = document.querySelector('a-scene');  
var playOnce = false; 

var setVisible = false;



AFRAME.registerComponent('markerobject', {
    tick: function () {
	
		const bot = document.querySelector('#TreeModel'); 		
		var scene = document.querySelector('a-scene');		
		var button = document.querySelector('#nextButton'); 		
		
		
         if (document.querySelector('a-marker').object3D.visible == true) {		
			if(!playOnce) {			
				bot.setAttribute("animation-mixer",startAnimTree); 
				playOnce = true;
				
				var startTrans = function () {
					scene.removeEventListener('animation-finished',startTrans); 
					bot.setAttribute("animation-mixer",loopAnimTree);					
					button.style.visibility = "visible";
					setVisible = true;
				};  
				

				scene.addEventListener('animation-finished',startTrans);				
			} else {			
				if(setVisible){
					button.style.visibility = "visible";				
				}
			}		   
        } 
		else {						
					
			button.style.visibility = "hidden";
        }
		
		

  //<div id="scene" class = "box" style="height: 100%; width: 100%;position:absolute;"  >   
     }
});



</script>

  <body style='margin : 0px; overflow: hidden;'>
	<a-scene sceneobject embedded arjs='trackingMethod: best;debugUIEnabled:false;  patternRatio:0.90' style="position:relative ;	height: 80%; width: 80%; margin: 0 auto; ">	
		
		<a-assets>
			<a-asset-item id="Tree" src="./Tree.glb"></a-asset-item>
		</a-assets>

		<a-marker markerobject preset='custom' type='pattern' url='./elevenmarker.patt'>	
			<a-entity id="TreeModel" gltf-model="#Tree" position = " 0 0 .5 " rotation = " 270 0 0" scale = " 2.5 2.5 2.5" animation-mixer></a-entity>	
		</a-marker> 
		
		<a-entity camera></a-entity>
	</a-scene>		
		<button id="nextButton" type="button" style="z-index: 5; position:relative ; top:50%; left:38%;width: 25%; visibility: hidden;" >Siguiente</button>	  

  </body>
  
</html>
