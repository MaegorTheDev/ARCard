<!DOCTYPE html>
<html>
<script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
<script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.6.0/aframe/build/aframe-ar.js"> </script>  
<script src="https://unpkg.com/aframe-particle-system-component@1.0.x/dist/aframe-particle-system-component.min.js"></script> 
<script>   

    
var startAnimTree = "clip: Take 001; loop: once; crossFadeDuration: 0;";;	
var loopAnimTree = "clip: Take 002; loop: repeat; crossFadeDuration: 0;";;
var listenerAdded = false;
var scene = document.querySelector('a-scene');  
var playOnce = false; 




AFRAME.registerComponent('markerobject', {
    tick: function () {
	
		const bot = document.querySelector('#TreeModel'); 		
		var scene = document.querySelector('a-scene');	
		
         if (document.querySelector('a-marker').object3D.visible == true) {		
			if(!playOnce) {			
				bot.setAttribute("animation-mixer",startAnimTree); 
				playOnce = true;
				
				var startTrans = function () {
					scene.removeEventListener('animation-finished',startTrans); 
					bot.setAttribute("animation-mixer",loopAnimTree);		
					StartCards();
				};  			

				scene.addEventListener('animation-finished',startTrans);

				//Show Cards
				StartCards();
			} 	   
        } 
		
  //<div id="scene" class = "box" style="height: 100%; width: 100%;position:absolute;"  >   
     }
});

function StartCards(){
	const cards = document.querySelector('#CardsModel'); 			
	var scene = document.querySelector('a-scene');		
	
	var value = "clip: Take 001; timeScale: 1; loop: once;";	
		//startedCards = 1;		
		cards.setAttribute("animation-mixer",value);			
		
		var nextAnim = function () {				
					scene.removeEventListener('animation-finished',nextAnim); 
					bot.setAttribute("animation-mixer","timeScale: 0;");	
				};  
				
		scene.addEventListener('animation-finished',nextAnim);			
		
	
}
//
//		<button id="nextButton" type="button" onclick="Next()"  
//		style="z-index: 5; position:relative ; top:50%; left:38%;width: 25%; visibility: hidden;" >Siguiente</button>	  


</script>

  <body style='margin : 0px; overflow: hidden;'>
	<a-scene sceneobject embedded arjs='trackingMethod: best; debugUIEnabled:false;  patternRatio:0.90' style="position:relative ;	height: 100%; width: 100%; margin: 0 auto; " vr-mode-ui="enabled: false">	
		<a-light type="ambient" color="#87CEEB" intensity = "2.5"></a-light>
		<a-assets>
			<a-asset-item id="Tree" src="./Tree.glb"></a-asset-item>
		</a-assets>
		
		<a-assets>
			<a-asset-item id="Cards" src="./Cards.glb"></a-asset-item>
		</a-assets>


		<a-marker markerobject preset='custom' type='pattern' url='./elevenmarker.patt'>	
			<a-entity id="TreeModel" gltf-model="#Tree" position = " 0 0 .5 " rotation = " 270 0 0" scale = " 2.5 2.5 2.5" animation-mixer></a-entity>	
			<a-entity id="CardsModel" gltf-model="#Cards" position = " 0 0 .25 " rotation = " 270 0 0" scale = " 2.5 2.5 2.5" animation-mixer = "clip: Take001; timeScale:0;"></a-entity>	
			<a-entity  position = " 0 0 5 "  particle-system="preset: snow; particleCount:6500; maxAge:12;"></a-entity>
		</a-marker> 
		
		<a-entity camera></a-entity>
	</a-scene>		

  </body>
  
</html>
